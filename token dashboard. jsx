import { useEffect, useState } from "react";
import { ethers } from "ethers";
import abi from "../abi/GameHubToken.json";

const contractAddress = "Ø¢Ø¯Ø±Ø³ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø±ÙˆÛŒ Sepolia";

export default function TokenDashboard({ userAddress }) {
  const [balance, setBalance] = useState("0");

  const getBalance = async () => {
    const provider = new ethers.BrowserProvider(window.ethereum);
    const contract = new ethers.Contract(contractAddress, abi.abi, provider);
    const bal = await contract.balanceOf(userAddress);
    setBalance(ethers.formatUnits(bal, 18));
  };

  const claimToken = async () => {
    const provider = new ethers.BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const contract = new ethers.Contract(contractAddress, abi.abi, signer);
    const tx = await contract.mint(userAddress, ethers.parseUnits("100", 18));
    await tx.wait();
    getBalance();
  };

  useEffect(() => {
    if (userAddress) getBalance();
  }, [userAddress]);

  return (
    <div className="text-center my-4">
      <p>ðŸŽ¯ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù†: {balance} GHT</p>
      <button onClick={claimToken} className="bg-green-600 text-white px-4 py-2 mt-2 rounded">
        Claim 100 GHT
      </button>
    </div>
  );
}